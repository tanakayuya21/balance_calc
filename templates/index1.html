<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <!--Font Awesome5-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
    <link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/jQuery-Validation-Engine/2.6.4/validationEngine.jquery.min.css" />
    <!--自作CSS -->
    <style type="text/css">
        .headers-name {
            padding-top: 4px;
            padding-right: 4px;
            padding-bottom: 2px;
            text-align: center;
            font-weight: bold;
        }
        body {
            background: #eee;
        }
        form {
            max-width: 700px;
            margin: auto;
            background: white;
            padding: 10px;
        }
        input {
            display: block;
            margin: auto;
            padding: 4px;
        }
        h5 {
            text-align: center;
        }
        /* 入力エラーのスタイル */
    </style>
</head>

<body>
    <!-- Navigation -->
    <!-- <nav class="navbar navbar-light navbar-dark bg-dark">
    <a class="navbar-brand" href="#">Bootstrap4 フォームコンポーネント ( HTMLバリデーション )</a>
</nav> -->
    <!-- Page Content -->
    <div class="container mt-5 p-lg-5 bg-light">
        <!-- <form class="needs-validation"   novalidate> -->
        <div class="form-row  headers-name mb-12">
            <div class="col-md-12 mb-4">
                <h2 for="lastName">残高計算システム</h2>
                <h1>{{.data}}</h1>
            </div>
        </div>
        <form id="apply-form" class="">
            <!-- <div class="form-row">
                <div class="col-md-6 mb-6">
                    <label for="lastName">イベント名</label><br>
                    <input type="text" class="validate[required] form-control" name="event_id" id="event_id"
                        placeholder=""><br>
                </div>
                <div class="col-md-6 mb-6">
                    <label for="lastName">予約日付</label><br>
                    <input type="date" class="validate[required,custom[date]]  form-control" id="date" placeholder="名字"
                        required><br>
                </div>
            </div> -->
            <!--氏名-->
            <div class="form-group row">
                <div class="col-sm-12">
                     <button type="button" id="edit" class="btn btn-primary btn-edit btn-block" value="登録"
                        onClick=""><b>新規登録</b></button>
                </div>
            </div>
            <label for="lastName">お名前</label>
            <div class="form-row mb-12">
                <div class="col-md-12 mb-3">
                    <input type="text" class="validate[required] form-control" id="name" placeholder="" required>
                    <!-- <div class="invalid-feedback">
                    入力してください
                </div> -->
                </div>
            </div>
            <div class="form-row">
                <div class="col-md-4 mb-3">
                    <label for="firstName">郵便番号で住所検索</label>
                    <input type="text" class="validate[required]  form-control" id="post" placeholder="ハイフン【-】無しで入力" required>
                </div>
                
                <div class="col-md-1 mb-3">
                    <label for="firstName"> 　</label>
                     <button  id="post-serch" class="btn btn-primary  btn-block" value="検索">
                     <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="col-md-7 mb-3">
                    <label for="firstName">　</label>
                    <select class="form-control" id="address1"  name="number" onChange="kakunin()">
                        <option value="1">住所未検索</option>
                    </select>
                </div>
            </div>
            <div class="col-xs-3">
                <div class="form-row mb-12">
                    <div class="col-md-12 mb-3">
                        <label for="firstName">住所</label>
                        <input type="text" class="validate[required]  form-control" id="address2" placeholder=""
                            required>
                    </div>
                </div>
                <label for="inputAddress01">携帯電話番号</label>
                <div class="form-row">
                    <div class="invalid-feedback">入力してください</div>
                    <div class="col-md-4 mb-3">
                        <input type="text" name="pref01" id="tel_num1"
                            class="validate[required,custom[number]] form-control" placeholder="" required>
                        <!-- <div class="invalid-feedback">入力してください</div> -->
                    </div>
                    <div class="col-md-4 mb-3">
                        <input type="text" name="pref01" id="tel_num2"
                            class="validate[required,custom[number]]  form-control" placeholder="" required>
                        <!-- <div class="invalid-feedback">入力してください</div> -->
                    </div>
                    <div class="col-md-4 mb-3">
                        <input type="text" name="pref01" id="tel_num3"
                            class="validate[required,custom[number]]  form-control" placeholder="" required>
                        <!-- <div class="invalid-feedback">入力してください</div> -->
                    </div>
                </div>
                <label for="lastName">メールアドレス</label>
                <div class="form-row">
                    <div class="invalid-feedback">入力してください</div>
                    <div class="col-md-7 mb-3">
                        <input type="text" class="validate[required] form-control" id="mail" placeholder=""
                        required>
                        <!-- <div class="invalid-feedback">入力してください</div> -->
                    </div>
                          <div class="col-md-1">
                    <label placeholder=""
                    required>@</label>
                </div>
                    <div id="" class="col-md-4 mb-3">
                        <input type="text" name="a" list="kenpo" class="validate[required] form-control" placeholder="ドメイン入力or選択" autocomplete="off">
                          <datalist  id="kenpo">
                            <option value="gmail.com">
                            <option value="docomo.co.jp">
                            <option value="softbank.ne.jp">
                            <option value="yahoo.co.jp">
                            <option value="ymobile.ne.jp">
                            <option value="i.softbank.ne.jp">
                            <option value="softbank.ne.jp">
                         </datalist>
                    </div>
                </div>
                </div>
                <div class="form-row">
                </div>
                <!-- <div class="invalid-feedback">
            入力してください
        </div> -->
                <!--備考欄-->
                <div class="form-group row">
                    <div class="col-sm-12">
                         <button type="button" id="edit" class="btn btn-primary btn-edit btn-block" value="登録"
                            onClick=""><b>編集</b></button>
                    </div>
                </div>
                    <h2>追加</h2>
                    <form method="post" action="/new">
                        <p>内容<input type="text" name="text" size="30" placeholder="入力してください" ></p>
                        <p>状態
                            <select name="status">
                                <option value="未実行">未実行</option>
                                <option value="実行中">実行中</option>
                                <option value="終了">終了</option>
                            </select>
                        </p>
                        <p><input type="submit" value="Send"></p>
                    </form>
                    
                    <ul>
                        {{ range .todos }}
                            <li>内容：{{ .Text }}、状態：{{ .Status }}
                                <label><a href="/detail/{{.ID}}">編集</a></label>
                                <label><a href="/delete_check/{{.ID}}">削除</a></label>
                            </li>
                        {{end}}
                    </ul>
            </body>
        </form>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <!-- 郵便番号から住所自動入力 -->
        <script src="https://ajaxzip3.github.io/ajaxzip3.js" charset="UTF-8"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jQuery-Validation-Engine/2.6.4/jquery.validationEngine.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jQuery-Validation-Engine/2.6.4/languages/jquery.validationEngine-ja.js"></script>

        <script>
            // $("#apply-form").validationEngine("attach", {focusFirstField: false});
            function kakunin() {
                var obj= $('option:selected').val();
                // var obj = document.getElementById('address1').value
                // 値(数値)を取得
                //const num = document.form1.color1.selectedIndex;
                // 値(数値)から値(value値)を取得
                const str = document.getElementById('address1').options[obj].text;
                if (obj != 0) {
                    document.getElementById('address2').value = str;
                    $('select#address1').css('background-color','#ffff');
                }
            }
            $('#post-serch').click(function () {
                var post = document.getElementById('post').value;
                var result = $.ajax({
                    headers: {                                                      //// HTTP ヘッダを構成
                        "Content-Type": "application/json",
                        "X-Requested-With": "XMLHttpRequest"                        //// Ajax
                    },
                    url: "http://geoapi.heartrails.com/api/json",
                    type: 'GET',
                    dataType: 'json',
                    data: {
                        postal: post,
                        method: 'searchByPostal',
                    },
                }).done(function (data) {
                    // APIから住所を取得
                    // 取得した住所を画面に設定
                    var value1 = data.response.location[0].prefecture + data.response.location[0].city + data.response.location[0].town;
                    $('select#address1 option').remove();
                    $('select#address1').css('background-color','#fff799');
                    $('#address1').append('<option value="0">住所を選択してください</option>');
                    //　設定する
                    index = 1
                    data.response.location.forEach(element => {
                        var address = element.prefecture + element.city + element.town
                        address = address.replace(/\"/g, "")
                        $('#address1').append('<option value="' + index + '">' + element.prefecture + element.city + element.town + '</option>');
                        index = index + 1
                    });
                }).fail(function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("error");
                })
            })

            $('#edit').click(function () {
                if ($("#apply-form").validationEngine("validate")) {
                    if(window.confirm("登録します。よろしいですか？")){
      
                    //  var hostId = document.getElementById('host_id').value;
                    var telNum1 = document.getElementById('tel_num1').value;
                    var telNum2 = document.getElementById('tel_num2').value;
                    var telNum3 = document.getElementById('tel_num3').value;
                    var tel_num_temp = telNum1 + telNum2 + telNum3;
                    var telNum = "+" + 81 + tel_num_temp.substr(1, 10);
                    var eventId = document.getElementById('event_id').value;
                    var date = document.getElementById('date').value;
                    var address = document.getElementById('address2').value;
                    var name = document.getElementById('name').value;
                    var post = document.getElementById('post').value;
                    var result = $.ajax({
                        headers: {                                                      //// HTTP ヘッダを構成
                            "Content-Type": "application/json",
                            "X-Requested-With": "XMLHttpRequest"                        //// Ajax
                        },
                        url: "http://geoapi.heartrails.com/api/json",
                        type: 'GET',
                        dataType: 'json',
                        data: {
                            postal: post,
                            method: 'searchByPostal',
                            // event_id: eventId,
                            // address: address,
                            // name: name,
                            // date: date,
                            // tel_num: telNum.trim()
                        },
                        // PUTの場合
                        // data: JSON.stringify({
                        //     postal: eventId,
                        //     method:'searchByPostal',
                        //     event_id: eventId,
                        //     address: address,
                        //     name: name,
                        //     date: date,
                        //     tel_num: telNum.trim()
                        // }),
                    }).done(function (data) {
                        // APIから住所を取得
                        // 取得した住所を画面に設定
                        // document.getElementById("address2").value = data.response.location[0].prefecture
                        //     + data.response.location[0].city
                        //     + data.response.location[0].town;
                        alert("登録しました。");
                    }).fail(function (XMLHttpRequest, textStatus, errorThrown) {
                        alert("error");
                    })
                }
                    else{
                      window.alert('キャンセルされました'); // 警告ダイアログを表示
                      return
                    }
                }
                // const PNF = require('google-libphonenumber').PhoneNumberFormat;
                // // Get an instance of `PhoneNumberUtil`.
                // const phoneUtil = require('google-libphonenumber').PhoneNumberUtil.getInstance();
                // // Parse number with country code and keep raw input.
                // const number = phoneUtil.parseAndKeepRawInput(telNumber, 'JP');
                // var numberTel =  phoneUtil.format(number, PNF.E164);
            })
        </script>
</body>

</html>